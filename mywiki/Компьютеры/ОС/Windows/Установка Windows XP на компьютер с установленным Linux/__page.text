!! Установка Windows XP на компьютер с установленным Linux

Задача: установить MS Windows XP на ваш компьютер, на котором у Вас установлен Linux Ubuntu. При этом на Вашем компьютере один жесткий диск. 

Используемые средства: Мы будем использовать программу Gnome Partition Editor (Gparted) входящую в состав дистрибутива Ubuntu LiveCD для изменения размера партиций что бы предоставить место для WindowsXP. Так как при установки WinXP, инсталлятор перепишит нам запись MBR (master boot record), мы восстановим загрузку с помощью GRUB и сделаем так что бы с помощью него мы могли выбрать загрузку Linux или WinXP.

Эта установка была проверена на компьютере с n-Forcе чипом и 80-гигайбайтном диском а также под управлением эмулятора компьюетра VMWare версии 5.5.3. 

!!! Подготавливаем систему Ubuntu 

Предполагается что у Вас в системе один жесткий диск, куда установлена система Linux Ubuntu и Вы обладаете достаточным свободным дисковым пространством для установки WinXP. 

Ваш жесткий диск может быть разбит на несколько партиций (для хранение системных данных и пользовательских данных). Это не помешает нам осуществить задуманное. 

Первым нашим шагом будет создание свободного пространствва для установки WinXP. Ubuntu LiveCD содержит программу Gnome Partition Editor , который является лучшим выбором для решения нашей задачи. 

Загрузитесь c LiveCD и в меню Система (System),Администрирование (Administration) и запустите Gnome Partition Editor . 

Главная партиция в Ubintu по умолчанию устанавливается в /dev/hda1 - в моем случае она является самой большой партиций и отформатирована в формате EX3. Так как я планирую изменить ее размер я кликаю по ней правой кнопкой мышки и выбираю позицию Resize/Move 

В диалоговом окне укажите новый размер партиции, что бы образовалось свободное пространство для WinXP (необходимо минимум 2 гигабайта). Нажмите кнопку Resize 

Нажмите 2 раза кнопку Apply и Gparted начнет процесс изменения размера партиций. 

После того как процесс закончится выньте из дисковода диск с LiveCD и вставьте диск с WinXP и перегрузите свой компьютер. 

!!! Как инсталировать WinXP 

После того как CD с инсталятором WinXP загрузится, нажмите клавишу Enter для установки WinXP, и нажмите F8 что бы согласится с лицензией. 

Когда инсталлятор предложит Вам выбрать партицию или место (для дальнейшегог там создания партиции) на винчестере для установки выберите свободное место для создания там партиции для WinXP (показанные партиции используются Вашим Ubuntu). 

Так как партиции для загрузки у нас стоит указатель на другую партицию /dev/hda1, а Windows не может инсталлировать на партицию не указанную для загрузки то он перепишит этот указатель. Поэтому просто нажмите enter для создания и форматирования партиции. 

Так как инсталлятор Windows обнаруужила две партиции принадлежащие Ubuntu от она обозвала партицию, куда собирается поставить Windows F: что не является привычным для пользователей. 

Но это не является большой проблемой, по крайне мене для современных приложений которые могут определить куда установленна Windows. 

Единственная проблема может возникнуть при использовании старых приложений которые не могут определить куда Windows установлена. 

Перезагрузите свой компьютер и убедитесь что у Вас загружается Windows XP. Загрузчик Ubuntu GRUB был стерт из MBR и мы не можем выбрать в меню Ubuntu и загрузить его. 

Есть способы как используя загрузчик Windows XP загрузить Ubuntu. Однако это трудно (кхм - прим. переводчика) и вынудит нас использовать файловую систему FAT32, посколько это файловая система доступна для чтения как под Ubuntu так и под WinXP. Но использование FAT32 под WinXP не выгодно с точки хрения эффективности работы WinXP а также с точки зрения безопасности работы приложений по сравнению с использованием файловой системой NTFS. 

Восстановим GRUB для загрузки ОС на Вашем компьютере. GRUB является универсальным загрузчиков для различных ОС и более гибкой в управлении. 

!!! Переустановка GRUB в MBR 

Следующим шагом будет загрузка компьютера с Ubuntu LiveCD. 

Запускаем снова утилиту GNOME Partition Editor где сможем увидеть что Windows была установлена в /dev/hda2 и этот раздел отмечен для начальной загрузки. 

Мы может оставить это как есть, но посколько мы собираемся заново установить GRUB нам есть смысл изменить этот параметр - это не приведет к уничтожению установленного Вами WinXP. 

Правой кнопкой мышки щелкните по партиции где установленна Windows, выберете меню Manage flags и снимите галочку у значения boot. Затем нажмите кнопку Close. Сделано. 

Теперь переустановим GRUB. Откройте терминал (Application,Accessories, Terminal) и введите команду: sudo grub 

Это запустит утилиту GRUB, теперь введите find /boot/grub/stage1 

Эта команда будет искать где установлен GRUB и вы должны получить результат hd(0,0). 

Измените активый корень на другое местоположение, введя: root (hd0,0) 

Теперь мы заново установим GRUB в MBR, не в раздел Ubuntu. 

Если бы мы хотели использовать загрузчик WinXP, то мы бы установили GRUB в hd(0,0), но так как нам это не интересно то мы впечатываем setup (hd0) 

Эта команда восстановит GRUB в MBR. Напечатайте QUIT и затем EXIT что бы выйти из GRUB и консоли. Перезагрузите систему. Компьютер загрузит Ubuntu так как она установлена по умолчанию. 

!!! Изменение меню GRUB 

Теперь нам осталось модифицировать меню загрузки GRUB что бы мы могли загружать WindowsXP. Дождитесь полной загрузки вашего Ubuntu и запустите терминал. Выполните команду:sudo gedit /boot/grub/menu.lst. 

 Эта команда загрузит файл меню GRUB (который фактически является текстовым файлом) в текстовый редактор GEdit 

Опускайте курсор вниз пока вы не увидите строчки ## ## End Default Options ##. 

Строчки которые мы можем увидеть являются пунктами меню GRUB. 

Что бы создать новый пункт меню в GRUB опуститесь в самый вниз (хотя Вы можете вставить эти строчки и в другое место) и введите следующие строчки: 

@@
title Windows XP
root (hd0,1)
makeactivechainloader 
@@

Эти строчки размещают новый элемент меню при загрузки а также указывают с какого раздела нужно грузиться. 

Если Вы хотите, то можете задать паузу при загрузке GRUB, для этого поднимитесь наверх файла menu.lst и найдите там строчку TIMEOUT. 

Численное значение указанное TIMEOUT указывает время, которое GRUB дает Вам для захода в меню с выбором загрузки, прежде чем начнет загружать с параметрами установленные по умолчанию. 

При использовании нескольких операционных значений я рекомендую Вам увеличиь значение этогго параметра. 

Выши строчки TIMEOUT находится строчка DEFULT, параметр которой указывает номер меню откуда будут браться параметры при загрузке по умолчанию. 

Система нумерации начинается с нуля и может быть больше, таким образом значение DEFAULT=0 предпологает что по умолчанию будет загружаться Ubuntu. Если Вы хотите что бы у Вас загружалось по умолчанию Windows XP измените это значение. 

Сохраните MENU.LST и выйдите из GEdit. Перезагрузите компьютер. 

При последующей загрузке Вы увидите приглашение войти в меню нажав клавишу Esc и там вы можете с помощью навигации выбрать WinXP и загрузить ее. 

!!! Удаление WindowsXP 

Если через какое то время у Вас возникнет задача удалить WinXP, то Вы сможете это сделать очень просто. 

Удалите запись о WinXP в файле MENU.LST. 

Загрузитесь с UBUNTU LIVE CD и запустите GNOME Partition Editor. Щелкните правой кнопкой по партиции где установленно WinXP (/dev/hda2) и выполните команду delete. 

Затем прарвой кнопкой мышки кликните по партиции где установленна UBUNTU и выберите позицию Resize/Move. Укажите новый размер партиции, таким образом что бы она заняла место освобожденное WinXP. 

После чего нажмите два раза кнопку "Apply", после чего начнется процесс преобразования партиции. 

Таким образом Вы вернетесь к начальным установкам, которые были у Вас перед установкой WinXP. Такой алгортм является достаточно красивым при удалении ОС, которая Вам не нужна