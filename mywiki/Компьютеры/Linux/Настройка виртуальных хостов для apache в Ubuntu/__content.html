<!DOCTYPE html>
<HTML>
<HEAD>
	<META HTTP-EQUIV='CONTENT-TYPE' CONTENT='TEXT/HTML; CHARSET=UTF-8'/>

	<STYLE type="text/css">
		body, div, p, table {
			font-size:10pt;
			font-family:Verdana;
		}

		img{border:none}
		
	</STYLE>
	
</HEAD>

<BODY>
<P>
<H1>Настройка виртуальных хостов для apache в Ubuntu</H1>
<BR> 
<BR>Привет всем!</P>

<P>Сегодня посмотрим как настроить виртуальные хосты (virtualhost) в ubuntu. Это позволит держать  несколько сайтов на одном компьютере. Для настройки потребуется виртуальная машина с установленной ubuntu server, а также установленный apache. Запускаем putty, авторизуемся и начинаем.</P>

<P>Для удобства переходим в дирректорию apache</P>

<P><CODE>
<BR>cd /etc/apache2/sites-available/
<BR></CODE></P>

<P>создаем файл для первого виртуального хоста.К примеру будем использовать site1.local, второй сайт будет site2.local, но о нем чуть позже</P>

<P><CODE>
<BR>sudo touch sites1.local
<BR></CODE></P>

<P>Теперь открываем первый virtualhost для сайта  sites1.local</P>

<P><CODE>
<BR>sudo nano sites1.local
<BR></CODE></P>

<P>В нем прописываем следующий текст</P>

<P>
<PRE>
&lt;VirtualHost *:80&gt;
ServerName site1.local
ServerAlias site1.local www.site1.local
DocumentRoot /var/site1.local/www/
&lt;Directory var/site1.local/www/&gt;
AllowOverride All
&lt;/Directory&gt;
&lt;/VirtualHost&gt;
</PRE></P>

<P>Нажимаем CTRL+O, чтобы сохранить изменения и CTRL+X, чтобы закрыть текстовый редактор nano, консольный текстовый редактор в Ubuntu. Теперь скопируем файл и отредактируем его, чтобы создать виртуальный хост для второго сайта  site2.local</P>

<P><CODE>
<BR>sudo cp sites1.local sites2.local
<BR>sudo nano sites2.local
<BR></CODE></P>

<P>
<PRE>
&lt;VirtualHost *:80&gt;
ServerName site2.local
ServerAlias site2.local www.site2.local
DocumentRoot /var/site2.local/www/
&lt;Directory var/site2.local/www/&gt;
AllowOverride All
&lt;/Directory&gt;
&lt;/VirtualHost&gt;
</PRE> </P>

<P>где
<BR>
<UL>
<LI>servername - навание сайта</LI>
<LI>ServerAlias — синонимы сайта, то есть можно обращаться как с www так и без www</LI>
<LI>DocumentRoot — расположение файлов сайта</LI>
<LI>&lt;Directory var/site2.local/www/&gt;  - описание разрешений для файлов и каталогов сайта</LI>
</UL>Теперь идем в каталог /var и создаем дирректории для сайтов</P>

<P><CODE>
<BR>sudo mkdir -p ./site1.local/www
<BR>sudo mkdir -p ./site2.local/www
<BR></CODE></P>

<P>Ключ -p для mkdir нужен для рекурсивного создания каталогов, то есть сначала будет создан каталог site1.local, потом сразу каталог www.</P>

<P>Теперь создаем 2 тестовые странички в каждом из каталогов www для каждого сайта. Для первого сайта</P>

<P><CODE>
<BR>sudo touch /var/site1.local/www/index.php
<BR>sudo nano /var/site1.local/www/index.php
<BR></CODE></P>

<P>в index.php пишем</P>

<P>
<PRE>
&lt;?php
echo &quot;&lt;h1&gt;Первый virtualhost для site1.local&lt;/h1&gt;&quot;
?&gt;
</PRE></P>

<P>теперь копируем файл для site2.local</P>

<P><CODE>
<BR>sudo cp /var/site1.local/www/index.php /var/site2.local/www/index.php
<BR>sudo nano /var/site2.local/www/index.php
<BR></CODE></P>

<P>в файл запихиваем немного другой текст, чтобы видно было различия</P>

<P>
<PRE>
&lt;?php
echo &quot;&lt;h1&quot;&gt;Второй virtualhost для site2.local&lt;/h1&gt;&quot;
?&gt;
</PRE></P>

<P>Теперь делаем сайты доступными, выполнив  команды</P>

<P><CODE>
<BR>sudo a2ensite site1.local
<BR>sudo a2ensite site2.local
<BR></CODE></P>

<P>и перезапускаем apache</P>

<P><CODE>
<BR>sudo service apache2 restart
<BR></CODE></P>

<P>или</P>

<P><CODE>
<BR>sudo /etc/init.d/apache2 restart
<BR></CODE></P>

<P>кому как нравится )))</P>

<P>Теперь можно проверять. Я запускаю виртуальную машину с windows xp. Так как у нас не установлен dns-сервер, то необходимо прописать ip адреса сайтов в файле C:\WINDOWS\system32\drivers\etc\hosts</P>

<P>Открываем его в текстовом редакторе и в конец дописываем строки</P>

<P>
<PRE>
192.168.3.1   site1.local
192.168.3.1   site2.local
192.168.3.1 — адрес вашего веб-сервера, если у вас другой, то указываете его.
</PRE></P>

<P>Запускаем браузер и набираем адреса сайтов, как видно — все работает</P>
</BODY>
</HTML>