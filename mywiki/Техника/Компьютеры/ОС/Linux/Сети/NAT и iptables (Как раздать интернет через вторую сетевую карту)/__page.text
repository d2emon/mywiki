!! NAT и iptables (Как раздать интернет через вторую сетевую карту)

Дано:
Сетевая карточка eth0 подключенная с помощью PPPoE к интернету и
eth1 подключенная к сети с адресом 192.168.0.1 к которой подключена сеть с адресами 192.168.0.* в которой нужно раздать интернет.

Для начала включим форвардинг:

@@
echo 1 > /proc/sys/net/ipv4/ip_forward
@@

Чтобы форвардинг автоматически включался при запуске системы

Открываем файл:

@@
sudo nano /etc/sysctl.conf
@@

и добавляем в него строчку:

@@
net.ipv4.ip_forward = 1
@@

Затем включаем NAT
@@
iptables -t nat -A POSTROUTING -o ppp0 -j MASQUERADE
@@

Где ppp0 название вашего интерфейса через который выходите в интернет.

Чтобы NAT работал после перезагрузки делаем следующее:

сохраняем настройки iptables в файл

@@
sudo iptables-save > /etc/iptables.up.rules
@@

И добавляем в конец файла:

@@
sudo nano /etc/networks/interfaces
@@

эту строчку, для автоматической подгрузке правил

@@
pre-up iptables-restore < /etc/iptables.up.rules
@@

Так же в этот файл добавляем правила роутинга:

@@
up route add -net 192.168.0.0 netmask 255.255.255.0 dev eth1
up route add -net 0.0.0.0 netmask 255.255.255.255 dev eth0
@@